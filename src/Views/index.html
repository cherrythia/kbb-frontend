<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="KbbStyle.css">
        <title>Kanban board</title>
    </head>
    <body>
        <noscript>
            <p>Please enable JavaScript to view this page.</p>
          </noscript>
          <div id="kanban" v-cloak>
            <header>
              <h1>Kanban board</h1>
              <form v-on:submit.prevent="create_card" action="create_task" method="POST">
                <input title="create card" src="static/plus_icon.svg" type="image" value="Create card" />
                <label>text: <input name="text" type="text" required="required" /></label>
                <label>colour: <input ref="new_card_color" title="Select colour" name="color" type="color" /></label>
              </form>
            </header>
            <div id="kanban-cols">
              <section class="column"
                v-bind:id="'column' + index"
                v-for="(column, index) in columns"
                ondrop="drop_handler(event);"
                ondragover="dragover_handler(event);"
                ondragleave="dragleave_handler(event);">
                <h2>{{ column }}</h2>
                <transition-group tag="ol" name="fade">
                  <li v-bind:id="'card' + card.id" draggable="true"
                    :key="card.id"
                    class="kanban-card"
                    v-bind:class="{ archived: card.archived }"
                    ondragstart="dragstart_handler(event);"
                    v-bind:style="{'background-color':  card.color}"
                    v-if="card.column === column && (card.archived === false || show_archived_cards)"
                    v-for="card in cards">
                    <a draggable="false" class="edit-icon" href='#' v-on:click.prevent="start_card_edit(card.id, $event)" title="edit">
                      <img src="static/edit_icon.svg" alt="edit" />
                    </a>
                    <span class="card_id" v-show="show_card_ids"><small>#{{ card.id }}</small></span>
                    <p class="card-text">{{ card.text }}</p>
                    <p class="card-last-updated"><small v-show="show_card_timestamps"> Update {{ Math.floor((Date.now() - Date.parse(card.modified)) / (1000*60*60*24)) }} day(s) ago</small></p>
                  </li>
                </transition-group>
              </section>
              <div ref="card_edit_container" v-on:keyup.Esc.prevent="cancel_card_edit" id="kanban-card-edit"  v-if="edit_card !== null" v-on:click="handle_card_edit_click">
                <div id="card_edit">
                  <form v-on:submit.prevent="complete_card_edit(edit_card.id, $event)" action="#" method="PUT">
                    <label class="color-label">Background color: <input title="Select colour" ref="card_edit_color" type="color" v-bind:value="edit_card.color"/></label>
                    <label class="archived-label">Archived?: <input title="Archive card" ref="card_edit_archive" type="checkbox" v-bind:checked="edit_card.archived"/></label>
                    <br />
                    <textarea v-on:keyup.ctrl.Enter="complete_card_edit(edit_card.id, $event)" ref="card_edit_text">{{edit_card.text}}</textarea>
                    <input class="save-card" type="submit" value="save" />
                  </form>
                  <button class="delete-card" v-on:click.once="delete_card(edit_card.id, $event)">delete card</button>
                </div>
              </div>
            </div>
            <div id="kanban-options">
              <label>show archived cards: <input type="checkbox" v-model="show_archived_cards" /></label>
              <label>show card IDs: <input type="checkbox" v-model="show_card_ids" /></label>
              <label>show last updated: <input type="checkbox" v-model="show_card_timestamps" /></label>
              <button v-on:click="refresh_cards">refresh data</button>
            </div>
          </div>
          <footer class="footer">
            <hr>
            <small>
              The source code for this site is available on <a
                href="https://github.com/FloatingOctothorpe/python-kanban">GitHub</a>.
            </small>
          </footer>
          <script src="static/vue.min.js"></script>
          <script src="static/kanban.js"></script>
    </body>
</html>